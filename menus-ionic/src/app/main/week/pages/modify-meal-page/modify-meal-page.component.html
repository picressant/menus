<ion-header [translucent]="true">
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-back-button defaultHref="/main/week"></ion-back-button>
        </ion-buttons>
        <ion-title>{{ isEditing ? 'Modifier le repas' : 'Repas' }}</ion-title>
        <ion-buttons slot="end" *ngIf="isEditing">
            <ion-button (click)="submit()">
                <ion-icon name="checkmark-sharp"></ion-icon>
            </ion-button>
        </ion-buttons>
    </ion-toolbar>
</ion-header>
<ion-content [fullscreen]="true">
    <ion-fab vertical="bottom" horizontal="end" slot="fixed"
             (click)="isEditing = true" *ngIf="!isEditing">
        <ion-fab-button>
            <ion-icon name="create-outline"></ion-icon>
        </ion-fab-button>
    </ion-fab>

    <div [hidden]="selectedTab !== footerDetails.selectedTab">
        <ion-item [disabled]="!isEditing">
            <ion-label>Convives :</ion-label>
            <ion-input type="number" *ngIf="meal" [(ngModel)]="meal.persons" (ionChange)="buildIngredients()"
                       [readonly]="!isEditing"></ion-input>
        </ion-item>
        <h3 class="ion-margin">Plat</h3>

        <app-week-meal-card
                [meal]="meal"
                [showSides]="false"
                (click)="clickOnMeal()"
                appLongPress
                (longPressed)="longPressedMeal()"
                [class.is-pressing]="isLongPressed"
                (longPressStarted)="refreshShaking(true)"
                (longPressCanceled)="refreshShaking(false)"
        ></app-week-meal-card>

        <h3 class="ion-margin with-icon">Accompagnements
            <ion-icon name="add-outline" *ngIf="isEditing" (click)="addSide()"></ion-icon>
        </h3>
        <ion-list *ngIf="meal?.sideDishes.length > 0">
            <ion-item *ngFor="let side of meal?.sideDishes; let i = index">
                <ion-label>
                    {{side.name}}
                </ion-label>
                <ion-icon slot="end" name="trash-outline" color="danger" (click)="deleteSide(i)"
                          *ngIf="isEditing"></ion-icon>
            </ion-item>
        </ion-list>
        <div *ngIf="meal?.sideDishes.length === 0">
            Aucun accompagnements
        </div>
    </div>

    <div [hidden]="selectedTab !== footerIngredients.selectedTab">
        <h3 class="ion-margin with-icon">Plat
            <ion-icon name="add-outline" *ngIf="isEditing && isMealFreeRecipe"
                      (click)="addIngredientToRecipe()"></ion-icon>
        </h3>
        <ion-list *ngIf="ingredients && !(isMealFreeRecipe && this.isEditing)">
            <ion-item *ngFor="let ingredient of ingredientRecipeMap | keyvalue: ingredientMapOrder">
                <ion-label slot="start">
                    {{ingredients[ingredient.key].name}}
                </ion-label>
                <ion-label slot="end">
                    {{ingredient.value}} {{ingredients[ingredient.key].unit.symbol}}
                </ion-label>
            </ion-item>
        </ion-list>
        <app-ingredients-quantity-list
                *ngIf="isMealFreeRecipe && isEditing"
                [ingredientsQuantity]="this.meal.recipe.ingredients"
                (delete)="deleteIngredientFromFree($event)"></app-ingredients-quantity-list>

        <h3 class="ion-margin">Accompagnements</h3>
        <ion-list *ngIf="ingredients">
            <ion-item *ngFor="let ingredient of ingredientSideMap | keyvalue: ingredientMapOrder">
                <ion-label slot="start">
                    {{ingredients[ingredient.key].name}}
                </ion-label>
                <ion-label slot="end">
                    {{ingredient.value}} {{ingredients[ingredient.key].unit.symbol}}
                </ion-label>
            </ion-item>
        </ion-list>
    </div>
</ion-content>

<app-footer-tab
        selectedTab="{{selectedTab}}"
        (elementSelect)="selectedTab = $event"
        [footerElements]="[footerDetails, footerIngredients]">
</app-footer-tab>
